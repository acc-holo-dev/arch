# Arch Installer (modular)

Этот проект собирает воспроизводимый установщик Arch Linux с модульными стадиями и настраиваемым списком пакетов. Цель — быстро поднять систему с Hyprland (AMD CPU + iGPU + NVIDIA dGPU), но конфигурация остаётся универсальной и управляется одним файлом `config.sh`.

## Требования
- Запуск из live-среды Arch/archiso с root-доступом.
- Доступ в интернет для установки пакетов и AUR.
- UEFI-система (используется `bootctl`).
- Инструменты: `pacstrap`, `parted`, `lsblk`, `arch-chroot`, `git` (для AUR).

## Быстрый старт (live-окружение archiso)
```bash
# 1) Подключите сеть
#    Wi‑Fi: iwctl station wlan0 connect MyWiFi
#    Ethernet: ip link set eth0 up && dhcpcd eth0

# 2) Синхронизируйте время
timedatectl set-ntp true

# 3) Получите исходники
pacman -Sy --noconfirm git
git clone https://github.com/arch-installer/modular-arch.git arch-installer
cd arch-installer

# 4) Настройте конфиг
nano config.sh

# 5) Сухой прогон без изменений на диске
bin/install.sh --dry-run

# 6) Полная установка (внимательно проверьте TARGET_DISK)
bin/install.sh

# 7) Запуск только одной стадии (например, apps)
bin/install.sh --stage apps
```

## Настройка через `config.sh`
Все пакеты, службы и базовые параметры вынесены в корневой файл [`config.sh`](config.sh). В нём можно:
- изменить пользователя/хостнейм и корневую точку монтирования;
- включать/выключать группы пакетов (Hyprland, разработка, шрифты, gaming, виртуализация);
- задать списки системных сервисов и AUR-пакетов;
- добавить свои наборы пакетов в массивы `PACMAN_*` и `AUR_*`.

После правок достаточно снова запустить `bin/install.sh` — модули автоматически подхватят настройки.

## Структура стадий
- **preflight** — проверка окружения, времени, сети и готовности к работе в UEFI.
- **disk** — разметка целевого диска, форматы и монтирование под `/mnt`.
- **system** — `pacstrap`, генерация `fstab`, локали/таймзона, загрузчик, гостевые драйверы.
- **apps** — установка основных пользовательских и графических пакетов (в т.ч. Hyprland) с учётом GPU/виртуализации.
- **postinstall** — создание пользователя, sudo, хостнейм, включение системных сервисов.
- **aur** — установка `yay` и пользовательских AUR-пакетов от имени созданного пользователя.

## Makefile
- `make lint` / `make shellcheck` — статический анализ скриптов.
- `make run` — сухой прогон через `bin/install.sh --dry-run`.
- `make package` — сборка архива `dist/arch-installer.tar.gz`.

## Логи и диагностика
Логи пишутся в `logs/install-*.log` (или в `/tmp/arch-install-*.log`, если папка недоступна). Уровень логирования выбирается через `--log-level`.

## Безопасность
Стадия `disk` выполняет разрушительные операции. Для реального запуска убедитесь, что `TARGET_DISK` в `config.sh` указывает на нужный диск и что сухой прогон прошёл без ошибок.
